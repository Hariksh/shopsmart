name: Deploy

on:
  push:
    branches: [main]

jobs:
  ci:
    name: Run CI
    uses: ./.github/workflows/ci.yml

  deploy:
    name: Trigger Render Deploy
    runs-on: ubuntu-latest
    needs: ci
    if: github.ref == 'refs/heads/main'

    steps:
      - name: Deploy to Render
        run: |
          curl -s -o /dev/null -w "%{http_code}" "${{ secrets.RENDER_DEPLOY_HOOK_URL }}" | grep -q "200" \
            && echo "✅ Deploy triggered successfully" \
            || (echo "❌ Deploy trigger failed" && exit 1)
